<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ðŸŒŠ GoodWave â€” Devnet Investor Preview</title>
<style>
  :root { color-scheme: dark; }
  body{margin:0;background:#0b0f17;color:#cfe3ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:1120px;margin:24px auto 56px;padding:0 16px}
  .hero{display:flex;flex-wrap:wrap;align-items:center;gap:18px;margin:12px 0 18px}
  .brand{display:flex;align-items:center;gap:.6rem}
  .brand h1{margin:0;font-size:32px;color:#2d6bff}
  .tag{flex:1;min-width:260px;color:#9fb4ff}
  .cta{display:flex;gap:10px;flex-wrap:wrap}
  .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  .primary{background:#2d6bff;color:#fff}
  .ghost{background:#121a2c;color:#cfe3ff;border:1px solid #23325a}
  .stats{margin:8px 0 6px;color:#bcd0ff}
  .stats b{color:#eaf1ff}
  .legend{display:flex;gap:16px;margin:6px 0 12px;font-size:13px;color:#9fb4ff}
  .dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:-1px}
  .b{background:#4e8cff}.g{background:#38d39f}.o{background:#ff9f40}

  #chart{width:100%;height:480px;background:#0e1421;border:1px solid #1a2340;border-radius:12px}
  canvas{width:100%;height:100%}

  .footer{margin-top:14px;font-size:12px;color:#7e8fb4;text-align:center}
  .pill{display:inline-block;padding:4px 8px;border:1px solid #23325a;border-radius:999px;background:#11192a;color:#aecdff;margin-left:8px;font-size:12px}

  /* Modal */
  .modal-back{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center;z-index:50}
  .modal{width:min(720px,92vw);background:#0f1627;border:1px solid #24345e;border-radius:14px;box-shadow:0 10px 30px #0007}
  .modal header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #1e2a4c}
  .modal h3{margin:0;font-size:18px}
  .modal .body{padding:14px 16px}
  .close{background:transparent;border:0;color:#9fb4ff;font-size:20px;cursor:pointer}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .card{border:1px solid #1e2a4c;background:#0b1324;border-radius:12px;padding:12px}
  .card h4{margin:0 0 6px 0;color:#eaf1ff}
  .kpi{font-size:20px;color:#eaf1ff}
  @media (max-width:760px){ .grid{grid-template-columns:1fr} .hero{flex-direction:column;align-items:flex-start} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <div style="font-size:28px">ðŸŒŠ</div>
        <h1>GoodWave â€” Devnet Investor Preview</h1>
        <span class="pill">Runwell module</span>
        <span class="pill">On-chain, DSSE-signed</span>
      </div>
      <div class="tag">
        Real staking yields with transparent fee sharing. Blue = Staked, Green = Earned, Orange = Platform Fees.
      </div>
      <div class="cta">
        <a class="btn primary" id="stakeBtn" href="#stake">Stake (Devnet demo)</a>
        <button class="btn ghost" id="tokenomicsBtn">View Tokenomics</button>
      </div>
    </div>

    <div class="stats" id="stats">
      <b>Total Staked:</b> â€” GWAVE &nbsp; | &nbsp;
      <b>Total Earned:</b> â€” GWAVE &nbsp; | &nbsp;
      <b>Total Fees Earned:</b> â€” GWAVE
      <span class="pill" id="points">points: â€”</span>
      <span class="pill" id="apy">APY: 12%</span>
      <span class="pill" id="lock">Lock: 30 days</span>
    </div>

    <div class="legend">
      <span><span class="dot b"></span>Staked</span>
      <span><span class="dot g"></span>Earned</span>
      <span><span class="dot o"></span>Fees (cumulative)</span>
    </div>

    <div id="chart"><canvas id="c"></canvas></div>
    <div class="footer">Updates ~every 60s from <code>docs/data/index.json</code> & <code>docs/data/ledger.tsv</code>. Powered by Runwell 2.1.</div>
  </div>

  <!-- Tokenomics Modal -->
  <div class="modal-back" id="tokBack" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <header>
        <h3>GWAVE Tokenomics (Devnet)</h3>
        <button class="close" id="tokClose" aria-label="Close">Ã—</button>
      </header>
      <div class="body">
        <div class="grid">
          <div class="card">
            <h4>Supply</h4>
            <div class="kpi">69,000,000 GWAVE</div>
            <div>Fixed; 6 decimals; mint held by admin (Devnet).</div>
          </div>
          <div class="card">
            <h4>Distribution</h4>
            <div>Admin treasury minus 3 GWAVE distributed 1/1/1 to marketing, team, liquidity.</div>
          </div>
          <div class="card">
            <h4>Rewards</h4>
            <div>Simulated 12% APY, compounding daily; payout loop logs to <code>ledger.tsv</code>.</div>
          </div>
          <div class="card">
            <h4>Fees</h4>
            <div>5% platform fee (Devnet) routed to Marketing; visible as orange cumulative line.</div>
          </div>
        </div>
        <p style="margin-top:10px;color:#9fb4ff">For mainnet, fee split and governance weights can be parameterized by DSSE-signed governance proposals.</p>
      </div>
    </div>
  </div>

<script>
const INDEX_URL  = 'data/index.json';
const LEDGER_URL = 'data/ledger.tsv';

const c = document.getElementById('c');
const ctx = c.getContext('2d');
const $stats = document.getElementById('stats');
const $points = document.getElementById('points');

function fmt(x){ return Number(x||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:6}); }

function sizeCanvas(){
  const w=c.clientWidth, h=c.clientHeight, r=window.devicePixelRatio||1;
  c.width=Math.floor(w*r); c.height=Math.floor(h*r); ctx.setTransform(r,0,0,r,0,0);
}

function draw(xs, staked, earned, fees){
  sizeCanvas();
  const w=c.clientWidth, h=c.clientHeight;
  ctx.clearRect(0,0,w,h);
  ctx.strokeStyle='#1a2a4f'; ctx.lineWidth=1;
  for(let i=0;i<6;i++){ const y=(h-40)*(i/5)+20; ctx.beginPath(); ctx.moveTo(50,y); ctx.lineTo(w-20,y); ctx.stroke(); }
  const padL=60, padR=20, padT=20, padB=30;
  const W=w-padL-padR, H=h-padT-padB;
  const maxY=Math.max(1,...staked,...earned,...fees);
  const toX=i=> padL + W * (i/Math.max(1,(xs.length-1)));
  const toY=v=> padT + H - (H*(v/maxY));
  function line(s,col){ if(!s.length) return; ctx.beginPath(); s.forEach((v,i)=>{const x=toX(i),y=toY(v); i?ctx.lineTo(x,y):ctx.moveTo(x,y)}); ctx.strokeStyle=col; ctx.lineWidth=2; ctx.stroke(); }
  line(staked,'#4e8cff'); line(earned,'#38d39f'); line(fees,'#ff9f40');
}

async function j(u){ const r=await fetch(u+'?t='+Date.now()); if(!r.ok) throw new Error(u+': '+r.status); return r.json(); }
async function t(u){ const r=await fetch(u+'?t='+Date.now()); if(!r.ok) return ''; return r.text(); }

function feesSeries(xs, text){
  const ev=[]; text.split('\n').forEach(l=>{
    if(!l.trim()) return; const [iso,label,amt]=l.split('\t'); if(!iso||!label||!label.startsWith('PlatformFee(')) return;
    const ts=Date.parse(iso); if(isNaN(ts)) return; const a=parseFloat(amt||'0'); if(!isFinite(a)) return; ev.push({ts,a});
  }); ev.sort((a,b)=>a.ts-b.ts);
  const out=[], xsT=xs.map(s=>Date.parse(s)); let i=0, sum=0;
  ev.forEach(e=>{ while(i<xsT.length && xsT[i] < e.ts){ out[i]=sum; i++; } sum+=e.a; while(i<xsT.length && xsT[i] <= e.ts){ out[i]=sum; i++; } });
  while(i<xsT.length){ out[i]=sum; i++; } return out.length?out:xs.map(()=>0);
}

async function load(){
  try{
    const data = await j(INDEX_URL);
    const xs = (data.points||[]).map(p=>p.ts);
    const staked = (data.points||[]).map(p=>Number(p.total_staked||0));
    const earned = (data.points||[]).map(p=>Number(p.total_earned||0));
    const ledger = await t(LEDGER_URL);
    const fees = feesSeries(xs, ledger);
    const feesTotal = fees.at(-1)||0;

    $stats.innerHTML =
      `<b>Total Staked:</b> ${fmt(staked.at(-1))} GWAVE &nbsp; | &nbsp; `+
      `<b>Total Earned:</b> ${fmt(earned.at(-1))} GWAVE &nbsp; | &nbsp; `+
      `<b>Total Fees Earned:</b> ${fmt(feesTotal)} GWAVE <span class="pill" id="points">points: ${(data.points||[]).length}</span>`+
      `<span class="pill">APY: 12%</span><span class="pill">Lock: 30 days</span>`;

    draw(xs, staked, earned, fees);
  }catch(e){ console.error(e); }
}
load(); setInterval(load, 10000); window.addEventListener('resize', ()=>load());

/* Modal wiring */
const tokBack = document.getElementById('tokBack');
document.getElementById('tokenomicsBtn').onclick=()=>{ tokBack.style.display='flex'; tokBack.setAttribute('aria-hidden','false'); };
document.getElementById('tokClose').onclick=()=>{ tokBack.style.display='none'; tokBack.setAttribute('aria-hidden','true'); };
tokBack.onclick=(e)=>{ if(e.target===tokBack) { tokBack.style.display='none'; tokBack.setAttribute('aria-hidden','true'); } };

/* Stake button (demo) */
document.getElementById('stakeBtn').onclick=(e)=>{ e.preventDefault(); alert('Devnet demo: staking is simulated from a local Runwell node.'); };
</script>
</body>
</html>
